name: CI
on:
  push:
    branches: 
            - main
  pull_request:
    branches:
            - main
  schedule:
  - cron: "0 6 * * *"
    displayName: Daily midnight build
  
  workflow_dispatch:
  
jobs:
  build:
    runs-on: windows-latest
    steps:
      - script: |
              npm install newman
              displayName: 'Install Newman'

      - script: |
              npm install -g newman-reporter-htmlextra
              displayName: 'Install Newman HTML Extra Reporter'

      - script: |
              newman run -x "postman/collections/restful-booker_880f2503-8ffd-4e76-9161-58262bc0c334.json" -e "postman/schemas/PlaySmart Environment 1.0.0.postman_environment.json" --reporters junit --reporter-junit-export Results\junitReport.xml --bail
              displayName: 'Run PlaySmart collection'

      - task: PublishTestResults@2
              inputs:
                  testResultsFormat: 'JUnit'
                  testResultsFiles: '**\junitReport.xml'
                  failTaskOnFailedTests: true
